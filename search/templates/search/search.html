{% extends 'main.html' %}
{% load querystring %}

{% block content %}
  <form action="{% url 'search' %}" method="get" class="mb-3">
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="input-group">
          <input type="search" class="form-control rounded-start-pill" name="q" value="{{ q }}" placeholder="Suche…">
          <button class="btn btn-dark rounded-end-pill px-4 ms-1">Suchen</button>
        </div>
      </div>
    </div>
  </form>


  <ul class="nav nav-tabs my-3" role="tablist">
    {% for t,label in tabs %}
      <li class="nav-item" role="presentation">
        <a
          class="nav-link {% if type == t %}active{% endif %}"
          href="{% url 'search' %}{% url_with type=t page=None %}"
          aria-current="{% if type == t %}page{% else %}false{% endif %}">
          {{ label }}
        </a>
      </li>
    {% endfor %}
  </ul>

  <div class="dropdown mb-3">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
      Sortierung: {% if sort == "alpha" %}Alphabetisch{% else %}Relevanz{% endif %}
    </button>
    <ul class="dropdown-menu">
      <li><a class="dropdown-item {% if sort == 'relevance' %}active{% endif %}" href="{% url 'search' %}{% url_with sort='relevance' page=None %}">Relevanz</a></li>
      <li><a class="dropdown-item {% if sort == 'alpha' %}active{% endif %}" href="{% url 'search' %}{% url_with sort='alpha' page=None %}">Alphabetisch (A–Z)</a></li>
    </ul>
  </div>



  {% if type == "all" %}
    {% if questions or variables or constructs %}
      {% if questions %}
        <section>
          <h2>Fragen ({{ questions_count }} Treffer)</h2>
          {% if questions %}
            {% for item in questions %}
              {% include "search/_card_question.html" with item=item %}
            {% endfor %}
            <p>
              <a href="{% url 'search' %}{% url_with type='questions' page=None %}">Mehr anzeigen</a>
            </p>
          {% else %}
            <p class="muted">Keine Fragen gefunden.</p>
          {% endif %}
        </section>
      {% endif %}

      {% if variables %}
        <section>
          <h2>Variablen ({{ variables_count }} Treffer)</h2>
          {% if variables %}
            {% for item in variables %}
              {% include "search/_card_variable.html" with item=item %}
            {% endfor %}
            <p>
              <a href="{% url 'search' %}{% url_with type='variables' page=None %}">Mehr anzeigen</a>
            </p>
          {% else %}
            <p class="muted">Keine Variablen gefunden.</p>
          {% endif %}
        </section>
      {% endif %}

      {% if constructs %}
        <section>
          <h2>Konstrukte ({{ constructs_count }} Treffer)</h2>
          {% if constructs %}
            {% for item in constructs %}
              {% include "search/_card_construct.html" with item=item %}
            {% endfor %}
            <p>
              <a href="{% url 'search' %}{% url_with type='constructs' page=None %}">Mehr anzeigen</a>
            </p>
          {% else %}
            <p class="muted">Keine Konstrukte gefunden.</p>
          {% endif %}
        </section>
      {% endif %}

    {% else %}
    <p class="muted">Keine Treffer gefunden.</p>
    {% endif %}
  {% endif %}


  {% if type == "questions" %}
    <h2>Fragen ({{ questions_count }} Treffer)</h2>

    {% if questions %}

      {% for item in questions %}
        {% include "search/_card_question.html" with item=item %}
      {% endfor %}

      {% if questions_page and questions_page.paginator.num_pages > 1 %}
        {% include "search/_pagination.html" with page_obj=questions_page type="questions" %}
      {% endif %}

    {% else %}
      <p class="muted">Keine Fragen gefunden.</p>
    {% endif %}

  {% endif %}

  {% if type == "variables" %}
  <h2>Variablen ({{ variables_count }} Treffer)</h2>

    {% if variables %}
      {% for item in variables %}
        {% include "search/_card_variable.html" with item=item %}
      {% endfor %}

      {% if variables_page and variables_page.paginator.num_pages > 1 %}
        {% include "search/_pagination.html" with page_obj=variables_page type="variables" %}
      {% endif %}

    {% else %}
      <p class="muted">Keine Variablen gefunden.</p>
    {% endif %}

  {% endif %}

  {% if type == "constructs" %}
    <h2>Konstrukte ({{ constructs_count }} Treffer)</h2>

    {% if constructs %}
      {% for item in constructs %}
        {% include "search/_card_construct.html" with item=item %}
      {% endfor %}

      {% if constructs_page and constructs_page.paginator.num_pages > 1 %}
        {% include "search/_pagination.html" with page_obj=constructs_page type="constructs" %}
      {% endif %}

    {% else %}
      <p class="muted">Keine Konstrukte gefunden.</p>
    {% endif %}
  {% endif %}


{% endblock %}
